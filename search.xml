<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>tableè¡¨æ ¼é‡Œåº”ç”¨çœç•¥å·text-overflow:ellipsis;</title>
      <link href="/2019/12/11/text-overflow-ellipsis-in-table/"/>
      <url>/2019/12/11/text-overflow-ellipsis-in-table/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><div align="middle"><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=115343&auto=1&height=66"></iframe></div><p>æœ¬æ–‡å‚è€ƒï¼šccs2.1ä¸­æ–‡ç‰ˆè§„èŒƒ <a href="http://www.ayqy.net/doc/css2-1/cover.html" target="_blank" rel="noopener">http://www.ayqy.net/doc/css2-1/cover.html</a><br>                  ccs2.1ä¸­æ–‡ç‰ˆè§„èŒƒtableéƒ¨åˆ† <a href="http://www.ayqy.net/doc/css2-1/tables.html#width-layout" target="_blank" rel="noopener">http://www.ayqy.net/doc/css2-1/tables.html#width-layout</a></p><h2 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h2><p>æ¥åˆ°éœ€æ±‚ï¼Œè¯´å¦‚æœ table é‡Œçš„å­—å¤ªå¤šå°±ç”¨çœç•¥å·ï¼Œå¾ˆè‡ªç„¶å°±æƒ³åˆ° text-overflow:ellipsis (ï¼Œæ³¨æ„ï¼šoverflow: hidden; text-overflow:ellipsis; white-space:nowrap ä¸€å®šè¦ä¸€èµ·ç”¨)ï¼Œä½†æ˜¯åœ¨ table ä¸­ä¸èµ·ä½œç”¨ï¼Œé—®åº¦å¨˜ï¼Œè¯´è¦æƒ³èµ·ä½œç”¨éœ€ç»™ tableå…ƒç´  è®¾å®š table-layout: fixed ï¼Œæœç„¶èµ·ä½œç”¨äº†ã€‚</p><h2 id="text-overflow-ellipsis-èµ·ä½œç”¨çš„å‰æ"><a href="#text-overflow-ellipsis-èµ·ä½œç”¨çš„å‰æ" class="headerlink" title="text-overflow:ellipsis èµ·ä½œç”¨çš„å‰æ"></a>text-overflow:ellipsis èµ·ä½œç”¨çš„å‰æ</h2><blockquote><p>1.ä¸€å®šè¦ç»™å®¹å™¨å®šä¹‰å®½åº¦<strong>ï¼ˆé‡ç‚¹ï¼‰</strong><br>2.å¦‚æœå°‘äº†overflow: hidden;æ–‡å­—ä¼šæ¨ªå‘æ’‘åˆ°å®¹æ˜“çš„å¤–é¢<br>3.å¦‚æœå°‘äº†white-space:nowrap;æ–‡å­—ä¼šæŠŠå®¹å™¨çš„é«˜åº¦å¾€ä¸‹æ’‘ï¼›å³ä½¿ä½ å®šä¹‰äº†é«˜åº¦ï¼Œçœç•¥å·ä¹Ÿä¸ä¼šå‡ºç°ï¼Œå¤šä½™çš„æ–‡å­—ä¼šè¢«è£åˆ‡æ‰<br>4.å¦‚æœå°‘äº† text-overflow:ellipsis; å¤šä½™çš„æ–‡å­—ä¼šè¢«è£åˆ‡æ‰ï¼Œå°±ç›¸å½“äºä½ è¿™æ ·å®šä¹‰ text-overflow:clip</p></blockquote><h2 id="ä¸Šé¢é‡ç‚¹çš„å‰æ"><a href="#ä¸Šé¢é‡ç‚¹çš„å‰æ" class="headerlink" title="ä¸Šé¢é‡ç‚¹çš„å‰æ"></a>ä¸Šé¢é‡ç‚¹çš„å‰æ</h2><p><strong>ä¸€å®šè¦ç»™å®¹å™¨å®šä¹‰å®½åº¦</strong>ï¼Œè¿™å°±æ˜¯ table-layout: fixed èµ·ä½œç”¨ï¼Œè€Œ table-layout: auto<strong>(tableå…ƒç´ é»˜è®¤ auto )</strong> ä¸èµ·ä½œç”¨çš„åŸå› ï¼Œä¸‹é¢ä¸€æ®µæ¥è‡ª css2.1 ä¸­æ–‡ç‰ˆè§„èŒƒï¼š</p><blockquote><p><strong>â€˜table-layoutâ€™</strong><br>&emsp;&emsp;&ensp;<em>Value:</em>  auto | fixed | <a href="http://www.ayqy.net/doc/css2-1/cascade.html#value-def-inherit" target="_blank" rel="noopener">inherit</a><br>&emsp;&emsp;&ensp;<em>Initial:</em>  auto<br>&emsp;&emsp;&ensp;<em>Applies to:</em>  â€˜tableâ€™å’Œâ€™inline-tableâ€™å…ƒç´ <br>&emsp;&emsp;&ensp;<em>Inherited:</em>  no<br>&emsp;&emsp;&ensp;<em>Percentages:</em>  N/A<br>&emsp;&emsp;&ensp;<em>Media:</em>  <a href="http://www.ayqy.net/doc/css2-1/media.html#visual-media-group" target="_blank" rel="noopener">visual</a><br>&emsp;&emsp;&ensp;<em>Computed value:</em>  ä¸æŒ‡å®šå€¼ç›¸åŒ</p></blockquote><blockquote><p><a href="http://www.ayqy.net/doc/css2-1/tables.html#propdef-table-layout" target="_blank" rel="noopener">â€˜table-layoutâ€™</a>å±æ€§æ§åˆ¶ç”¨äºè¡¨æ ¼å•å…ƒï¼Œè¡Œå’Œåˆ—å¸ƒå±€çš„ç®—æ³•ã€‚å€¼å«ä¹‰å¦‚ä¸‹ï¼š</p><p><strong>fixed</strong><br>&emsp;&emsp;&ensp;ç”¨å›ºå®šè¡¨æ ¼å¸ƒå±€ç®—æ³•<br><strong>auto</strong><br>&emsp;&emsp;&ensp;ç”¨ä»»æ„è‡ªåŠ¨è¡¨æ ¼å¸ƒå±€ç®—æ³•</p></blockquote><p><strong>(fixedå’ŒautoåŒºåˆ«å°±æ˜¯ä¸€ä¸ªå›ºå®šï¼Œä¸€ä¸ªè‡ªåŠ¨)</strong></p><p>ä¸‹æ–‡æè¿°äº†è¿™ä¸¤ç§ç®—æ³•:</p><h5 id="åœ¨å›ºå®šè¡¨æ ¼å¸ƒå±€ç®—æ³•ä¸­-fixed-ï¼Œæ¯åˆ—çš„å®½åº¦ç”±ä¸‹è¿°è§„åˆ™å†³å®šï¼š"><a href="#åœ¨å›ºå®šè¡¨æ ¼å¸ƒå±€ç®—æ³•ä¸­-fixed-ï¼Œæ¯åˆ—çš„å®½åº¦ç”±ä¸‹è¿°è§„åˆ™å†³å®šï¼š" class="headerlink" title="åœ¨å›ºå®šè¡¨æ ¼å¸ƒå±€ç®—æ³•ä¸­(fixed)ï¼Œæ¯åˆ—çš„å®½åº¦ç”±ä¸‹è¿°è§„åˆ™å†³å®šï¼š"></a>åœ¨å›ºå®šè¡¨æ ¼å¸ƒå±€ç®—æ³•ä¸­(fixed)ï¼Œæ¯åˆ—çš„å®½åº¦ç”±ä¸‹è¿°è§„åˆ™å†³å®šï¼š</h5><blockquote><p>1.ä¸€ä¸ª width å±æ€§å€¼ä¸ä¸ºâ€™autoâ€™çš„åˆ—å…ƒç´ æ‰€åœ¨çš„åˆ—å®½åº¦å°±è®¾ç½®ä¸ºè¯¥å®½åº¦å€¼<br>2.å¦åˆ™ï¼Œç”±ç¬¬ä¸€è¡Œä¸­ width å±æ€§å€¼ä¸ä¸ºâ€™autoâ€™çš„å•å…ƒæ ¼ç¡®å®šè¯¥åˆ—çš„å®½åº¦ã€‚å¦‚æœå•å…ƒæ ¼è·¨è¶Šäº†å¤šåˆ—ï¼Œå°±æŠŠå®½åº¦åˆ†åˆ°è¿™äº›åˆ—ä¸­(the width is divided over the columns)<br>3.æ‰€æœ‰å‰©ä½™åˆ—å‡åˆ†å‰©ä½™çš„æ°´å¹³è¡¨æ ¼ç©ºé—´ (å‡å»è¾¹æ¡†æˆ–å•å…ƒæ ¼é—´è·)</p></blockquote><p><strong>3ä¸­è¯´åˆ°ï¼Œæ‰€æœ‰å‰©ä½™åˆ—å‡åˆ†å‰©ä½™çš„æ°´å¹³è¡¨æ ¼ç©ºé—´ï¼Œå®é™…æƒ…å†µå°±æ˜¯tableå°†å‰©ä½™åˆ—çš„å®½åº¦å¹³å‡åˆ†ï¼Œå›ºå®šæ¯åˆ—çš„å®½åº¦å°±æ˜¯ å‰©ä½™å®½åº¦/å‰©ä½™åˆ—æ•° ï¼Œtext-overflow:ellipsis èµ·ä½œç”¨çš„å‰æå°±æ˜¯ä¸€å®šè¦ç»™å®¹å™¨å®šä¹‰å®½åº¦ï¼Œæ‰€ä»¥fixedèµ·ä½œç”¨äº†ã€‚</strong></p><h5 id="åœ¨è‡ªåŠ¨è¡¨æ ¼å¸ƒå±€ç®—æ³•ä¸­-fixed-ï¼Œåˆ—å®½ç”±ä¸‹åˆ—æ­¥éª¤å†³å®šï¼š"><a href="#åœ¨è‡ªåŠ¨è¡¨æ ¼å¸ƒå±€ç®—æ³•ä¸­-fixed-ï¼Œåˆ—å®½ç”±ä¸‹åˆ—æ­¥éª¤å†³å®šï¼š" class="headerlink" title="åœ¨è‡ªåŠ¨è¡¨æ ¼å¸ƒå±€ç®—æ³•ä¸­(fixed)ï¼Œåˆ—å®½ç”±ä¸‹åˆ—æ­¥éª¤å†³å®šï¼š"></a>åœ¨è‡ªåŠ¨è¡¨æ ¼å¸ƒå±€ç®—æ³•ä¸­(fixed)ï¼Œåˆ—å®½ç”±ä¸‹åˆ—æ­¥éª¤å†³å®šï¼š</h5><blockquote><p>1.è®¡ç®—æ¯ä¸ªå•å…ƒæ ¼çš„æœ€å°å†…å®¹å®½åº¦(MCW)ï¼šæ ¼å¼åŒ–çš„å†…å®¹å¯ä»¥è·¨è¶Šä»»æ„å¤šè¡Œï¼Œä½†ä¸èƒ½ä»å•å…ƒæ ¼æº¢å‡ºã€‚å¦‚æœå•å…ƒæ ¼æŒ‡å®šçš„<a href="http://www.ayqy.net/doc/css2-1/visudet.html#propdef-width" target="_blank" rel="noopener">â€˜widthâ€™</a>(W)å¤§äºMCWï¼ŒWå°±æ˜¯æœ€å°å•å…ƒæ ¼å®½åº¦ã€‚â€™autoâ€™å€¼è¡¨ç¤ºMCWæ˜¯æœ€å°å•å…ƒæ ¼å®½åº¦ï¼Œç„¶åï¼Œè®¡ç®—æ¯ä¸ªå•å…ƒæ ¼çš„â€œæœ€å¤§â€å®½åº¦ï¼šæ ¼å¼åŒ–å†…å®¹ï¼Œä¸è€ƒè™‘é™¤æ˜¾å¼æ¢è¡Œå¤–çš„æ¢è¡Œã€‚<br>2.å¯¹äºæ¯ä¸€åˆ—ï¼Œä»åªè·¨è¶Šè¯¥åˆ—çš„å•å…ƒæ ¼ä¸­ç¡®å®šä¸€ä¸ªæœ€å¤§å’Œæœ€å°åˆ—å®½ã€‚æœ€å°åˆ—å®½æ˜¯æœ€å°å•å…ƒæ ¼å®½åº¦ä¸­æœ€å¤§çš„é‚£ä¸ªæ‰€éœ€è¦çš„æœ€å°åˆ—å®½ï¼ˆæˆ–è€…åˆ—<a href="http://www.ayqy.net/doc/css2-1/visudet.html#propdef-width" target="_blank" rel="noopener">â€˜widthâ€™</a>ï¼Œçœ‹å“ªä¸ªæ›´å¤§ï¼‰ã€‚æœ€å¤§åˆ—å®½æ˜¯æœ€å¤§å•å…ƒæ ¼å®½åº¦ä¸­æœ€å¤§çš„é‚£ä¸ªæ‰€éœ€è¦çš„æœ€å¤§åˆ—å®½ï¼ˆæˆ–è€…åˆ—<a href="http://www.ayqy.net/doc/css2-1/visudet.html#propdef-width" target="_blank" rel="noopener">â€˜widthâ€™</a>ï¼Œçœ‹å“ªä¸ªæ›´å¤§ï¼‰ã€‚<br>3.å¯¹äºæ¯ä¸ªè·¨è¶Šå¤šåˆ—çš„å•å…ƒæ ¼ï¼Œå¢åŠ å®ƒè·¨è¶Šçš„åˆ—çš„æœ€å°å®½åº¦ï¼Œè®©å®ƒä»¬è‡³å°‘ä¸å•å…ƒæ ¼ä¸€æ ·å®½ã€‚å¯¹äºæœ€å¤§å®½åº¦ä¹Ÿè¿™æ ·å¤„ç†ã€‚å¦‚æœå¯èƒ½çš„è¯ï¼ŒæŠŠè·¨è¶Šçš„æ‰€æœ‰åˆ—å†æ‰©å®½å·®ä¸å¤šç›¸åŒå®½åº¦ã€‚<br>4.å¯¹äºæ¯ä¸ªâ€™widthâ€™ä¸ä¸ºâ€™autoâ€™çš„åˆ—ç»„å…ƒç´ ï¼Œå¢åŠ å®ƒè·¨è¶Šçš„åˆ—çš„æœ€å°å®½åº¦ï¼Œè®©å®ƒä»¬è‡³å°‘ä¸åˆ—ç»„çš„â€™widthâ€™ä¸€æ ·å®½ã€‚</p></blockquote><p><strong>å…¶å®æœ‰äº›äº‹å¾ˆç®€å•ï¼Œä½†æ˜¯è¯´èµ·æ¥å°±æ˜¯ç»•å˜´ã€‚ã€‚ã€‚<br>1ä¸­è¯´åˆ°ï¼Œå¦‚æœå•å…ƒæ ¼æŒ‡å®šçš„<a href="http://www.ayqy.net/doc/css2-1/visudet.html#propdef-width" target="_blank" rel="noopener">â€˜widthâ€™</a>(W)å¤§äºMCWï¼ŒWå°±æ˜¯æœ€å°å•å…ƒæ ¼å®½åº¦ã€‚â€™autoâ€™å€¼è¡¨ç¤ºMCWæ˜¯æœ€å°å•å…ƒæ ¼å®½åº¦ã€‚</strong></p><p><strong>æƒ…å†µä¸€ï¼šå½“W &gt; MCWæ—¶ï¼ŒWæ˜¯æœ€å°å•å…ƒæ ¼å®½åº¦ï¼Œè¯´æ˜ åˆ—å®½ = Wï¼Œåˆ—å®½ è£…å¾—ä¸‹æ–‡å­—ï¼Œç”¨ä¸ä¸Šçœç•¥å·ã€‚</strong></p><p><strong>æƒ…å†µäºŒï¼šå½“W &lt; MCWæ—¶ï¼ŒMCWæ˜¯æœ€å°å•å…ƒæ ¼å®½åº¦æ—¶ï¼Œè¯´æ˜ åˆ—å®½ = MCWï¼Œä½†æ˜¯è¿™ä¸ªMCWæ˜¯æ–‡å­—æ’‘æ»¡ä¸‹è®¡ç®—å‡ºæ¥çš„ï¼Œæ—¢ç„¶æ˜¯æ’‘æ»¡ï¼Œç”¨çœç•¥å·å¹²å˜›ã€‚ã€‚ã€‚</strong></p><p><strong>è¦æƒ³åœ¨ä¸ä½¿ç”¨table-layout:fixedçš„æƒ…å†µä¸‹ï¼Œå³table-layout:autoå‰æä¸‹ç”¨ellipsisï¼Œå¯ä»¥åƒä¸‹é¢è¿™æ ·åš(åœ¨tdé‡Œå†å¥—ä¸€ä¸ªå…ƒç´ ï¼Œå¯¹è¿™ä¸ªå…ƒç´ è®¾ç½®ellipsis)ã€‚</strong></p><pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css">    <span class="token selector">div </span><span class="token punctuation">{</span>      <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token selector"><span class="token class">.ellipsis</span> </span><span class="token punctuation">{</span>      <span class="token property">text-overflow</span><span class="token punctuation">:</span>ellipsis<span class="token punctuation">;</span>      <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>       <span class="token property">text-overflow</span><span class="token punctuation">:</span>ellipsis<span class="token punctuation">;</span>       <span class="token property">white-space</span><span class="token punctuation">:</span>nowrap<span class="token punctuation">;</span>    <span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ellipsis<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> css </category>
          
      </categories>
      
      
        <tags>
            
            <tag> overflow </tag>
            
            <tag> table </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€è¯‘ã€‘Promise/A+è§„èŒƒ</title>
      <link href="/2019/12/03/translate-promise-a-plus-specifications/"/>
      <url>/2019/12/03/translate-promise-a-plus-specifications/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote><p>åŸæ–‡ï¼š<a href="https://promisesaplus.com" target="_blank" rel="noopener">https://promisesaplus.com</a></p></blockquote><div class="promisesa">Promises/A+</div><p><strong>Promises/A+æ˜¯ä¸€ä¸ªå¼€æ”¾æ ‡å‡†ï¼Œä¸€ä¸ªè§„å®šäº†å¦‚ä½•äº’ç›¸åµŒå¥—ä½¿ç”¨ JavaScript promises çš„å¼€æ”¾æ ‡å‡†â€”ç”±å®ç°è€…åˆ¶å®šå’Œä½¿ç”¨ã€‚</strong></p><p>ä¸€ä¸ª <em>promise</em> ä»£è¡¨å¼‚æ­¥æ“ä½œçš„æœ€ç»ˆç»“æœã€‚ä¸ promise äº¤äº’çš„ä¸»è¦æ–¹æ³•æ˜¯ä½¿ç”¨å®ƒçš„ <code>then</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ³¨å†Œå›è°ƒå‡½æ•°æ¥æ¥æ”¶ promise æœ€ç»ˆçš„ value æˆ–è€… promise ä¸èƒ½æ­£å¸¸å®Œæˆï¼ˆfulfillï¼‰çš„ reasonã€‚</p><p>æœ¬è§„èŒƒè¯¦ç»†æè¿°äº† <code>then</code> æ–¹æ³•çš„è¡Œä¸ºï¼Œç»™æ‰€æœ‰éµå¾ª Promises/A+ è§„èŒƒå®ç°çš„ promise æä¾›ä¸€ä»½å®ç°åŸºç¡€ã€‚æ‰€ä»¥ï¼Œå¯ä»¥è®¤ä¸ºæœ¬è§„èŒƒæ˜¯éå¸¸ç¨³å®šçš„ã€‚å°½ç®¡ promise/A+ ç»„ç»‡å¯èƒ½å¶å°”ä¼šå¯¹è¿™ä¸ªè§„èŒƒåšå‘åå…¼å®¹çš„å°ä¿®æ”¹ä»¥è§£å†³æ–°å‘ç°çš„è¾¹ç•Œé—®é¢˜ï¼Œåªæœ‰åœ¨ä»”ç»†è€ƒè™‘ã€è®¨è®ºå’Œæµ‹è¯•ä¹‹åï¼Œæˆ‘ä»¬æ‰ä¼šé›†æˆå¤§å‹çš„æˆ–å‘åä¸å…¼å®¹çš„å˜æ›´ã€‚</p><p>ä»å†å²ä¸Šçœ‹ï¼ŒPromises/A+ æ¾„æ¸…äº†æ—©æœŸ <a href="http://wiki.commonjs.org/wiki/Promises/A" target="_blank" rel="noopener">Promises/A</a> æè®®çš„è¡Œä¸ºæ¡æ¬¾ï¼Œæ‰©å±•å®ƒä»¥è¦†ç›– <em>äº‹å®</em> è¡Œä¸ºï¼Œå¹¶åˆ é™¤æœªæŒ‡å®šæˆ–æœ‰é—®é¢˜çš„éƒ¨åˆ†ã€‚</p><p>æœ€åï¼ŒPromises/A+ è§„èŒƒçš„æ ¸å¿ƒä¸ä¼šå»æ¼”ç¤ºå¦‚ä½•åˆ›å»ºã€å®Œæˆï¼ˆfulfillï¼‰æˆ–è€…æ‹’ç»ï¼ˆrejectï¼‰promises å¯¹è±¡ï¼Œé€‰æ‹©å°†é‡ç‚¹æ”¾åœ¨æä¾›ä¸€ä¸ªäº’ç›¸åµŒå¥—çš„thenæ–¹æ³•ä¸Šã€‚æœªæ¥åœ¨ç›¸å…³è§„èŒƒçš„å·¥ä½œä¸­å¯èƒ½ä¼šæ¶‰åŠè¿™äº›ä¸»é¢˜ã€‚</p><h2 id="æœ¯è¯­"><a href="#æœ¯è¯­" class="headerlink" title="æœ¯è¯­"></a>æœ¯è¯­</h2><ol><li>â€œpromiseâ€ æ˜¯ä¸€ä¸ªå…·æœ‰ <code>then</code> æ–¹æ³•çš„å¯¹è±¡æˆ–å‡½æ•°ï¼Œè¯¥ <code>then</code> æ–¹æ³•çš„è¡Œä¸ºç¬¦åˆè¿™ä¸ªè§„èŒƒã€‚</li><li>â€œthenableâ€ æ˜¯ä¸€ä¸ªå®šä¹‰äº† <code>then</code> æ–¹æ³•çš„å¯¹è±¡æˆ–å‡½æ•°ã€‚</li><li>â€œvalueâ€ æ˜¯ä»»ä½•åˆæ³•çš„ JavaScript å€¼ï¼ˆåŒ…æ‹¬ <code>undefined</code>ã€thenable æˆ– promiseï¼‰ã€‚</li><li>â€œexceptionâ€ æ˜¯ä½¿ç”¨ <code>throw</code> è¯­å¥æŠ›å‡ºçš„ä¸€ä¸ªå€¼ã€‚</li><li>â€œreasonâ€ æ˜¯ä¸€ä¸ªå€¼ï¼Œå®ƒæŒ‡ç¤ºäº†ä¸€ä¸ª promise ä¸ºä»€ä¹ˆè¢«æ‹’ç»ï¼ˆrejectedï¼‰ã€‚</li></ol><h2 id="è¦æ±‚"><a href="#è¦æ±‚" class="headerlink" title="è¦æ±‚"></a>è¦æ±‚</h2><h3 id="promise-çš„çŠ¶æ€"><a href="#promise-çš„çŠ¶æ€" class="headerlink" title="promise çš„çŠ¶æ€"></a>promise çš„çŠ¶æ€</h3><p>promise å¿…é¡»æ˜¯ä¸‰ç§çŠ¶æ€ä¹‹ä¸€ï¼špendingï¼ˆç­‰å¾…æ€ï¼‰ã€fulfilledï¼ˆå®Œæˆæ€ï¼‰æˆ– rejectedï¼ˆæ‹’ç»æ€ï¼‰ã€‚</p><ol><li><p>å¤„äº pendingï¼Œpromiseï¼š</p><ol><li>å¯ä»¥è¿‡æ¸¡åˆ° fulfilled æˆ– æˆ–rejected çŠ¶æ€ã€‚</li></ol></li><li><p>å¤„äº fulfilledï¼Œpromiseï¼š</p><ol><li>ä¸€å®šä¸èƒ½è¿‡æ¸¡åˆ°ä»»ä½•å…¶ä»–çŠ¶æ€ã€‚</li><li>å¿…é¡»æœ‰ä¸€ä¸ªä¸å˜çš„ valueã€‚</li></ol></li><li><p>å¤„äº rejectedï¼Œpromiseï¼š</p><ol><li>ä¸€å®šä¸èƒ½è¿‡æ¸¡åˆ°ä»»ä½•å…¶ä»–çŠ¶æ€ã€‚</li><li>å¿…é¡»æœ‰ä¸€ä¸ªä¸å˜çš„ reasonã€‚</li></ol></li></ol><p>è¿™é‡Œè¯´çš„ â€œä¸å˜â€ æ˜¯æŒ‡ï¼Œä¸å˜çš„å¼•ç”¨ï¼ˆå³ <code>===</code>ï¼‰ï¼Œä½†å¹¶ä¸æ„å‘³ç€æ·±åº¦ä¸å˜ã€‚</p><h3 id="then-æ–¹æ³•"><a href="#then-æ–¹æ³•" class="headerlink" title="then æ–¹æ³•"></a><code>then</code> æ–¹æ³•</h3><p>ä¸€ä¸ª promise å¿…é¡»æä¾›ä¸€ä¸ª <code>then</code> æ–¹æ³•æ¥è®¿é—®å®ƒå½“å‰æˆ–æœ€ç»ˆçš„ value æˆ– reasonã€‚<br>ä¸€ä¸ª promise çš„ <code>then</code> æ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼š</p><pre class="line-numbers language-js"><code class="language-js">promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>onFulfilled<span class="token punctuation">,</span> onRejected<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol><li><p><code>onFulfilled</code> å’Œ <code>onRejected</code> éƒ½æ˜¯å¯é€‰å‚æ•°ï¼š</p><ol><li>å¦‚æœ <code>onFulfilled</code> ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå¿…é¡»è¢«å¿½ç•¥ã€‚</li><li>å¦‚æœ <code>onRejected</code> ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå¿…é¡»è¢«å¿½ç•¥ã€‚</li></ol></li><li><p>å¦‚æœ <code>onFulfilled</code> æ˜¯ä¸€ä¸ªå‡½æ•°ï¼š</p><ol><li>å®ƒå¿…é¡»åœ¨ <code>promise</code> fulfilled åè¢«è°ƒç”¨ï¼Œ<code>promise</code> çš„ value æ˜¯å®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚</li><li>å®ƒä¸€å®šä¸èƒ½åœ¨ <code>promise</code> fulfilled ä¹‹åè°ƒç”¨ã€‚</li><li>å®ƒä¸èƒ½è¢«è°ƒç”¨è¶…è¿‡ä¸€æ¬¡ã€‚</li></ol></li><li><p>å¦‚æœ <code>onRejected</code> æ˜¯ä¸€ä¸ªå‡½æ•°ï¼š</p><ol><li>å®ƒå¿…é¡»åœ¨ <code>promise</code> rejected åè¢«è°ƒç”¨ï¼Œ<code>promise</code> çš„ reason æ˜¯å®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚</li><li>å®ƒä¸€å®šä¸èƒ½åœ¨ <code>promise</code> rejected ä¹‹åè°ƒç”¨ã€‚</li><li>å®ƒä¸èƒ½è¢«è°ƒç”¨è¶…è¿‡ä¸€æ¬¡ã€‚</li></ol></li><li><p><code>onFulfilled</code> æˆ– <code>onRejected</code> åªæœ‰åœ¨ <a href="https://es5.github.io/#x10.3" target="_blank" rel="noopener">æ‰§è¡Œä¸Šä¸‹æ–‡</a> å †æ ˆä»…åŒ…å«å¹³å°ä»£ç æ—¶æ‰å¯è¢«è°ƒç”¨<sup><a id="ref-3-1" href="#3-1" rel="footnote">[3.1]</a></sup>ã€‚</p></li><li><p><code>onFulfilled</code> å’Œ <code>onRejected</code> å¿…é¡»è¢«ä½œä¸ºå‡½æ•°è°ƒç”¨ï¼ˆå³æ²¡æœ‰ <code>this</code> å€¼ï¼‰ã€‚<sup><a id="ref-3-2" href="#3-2" rel="footnote">[3.2]</a></sup></p></li><li><p><code>then</code> æ–¹æ³•å¯ä»¥è¢«åŒä¸€ä¸ª promise å¯¹è±¡è°ƒç”¨å¤šæ¬¡ã€‚</p><ol><li>å¦‚æœ/å½“ <code>promise</code> æ‰§è¡Œå®Œæˆåï¼Œæ‰€æœ‰ç›¸åº”çš„ <code>onFulfilled</code> å›è°ƒå‡½æ•°ï¼Œå¿…é¡»æŒ‰ç…§å¯¹ <code>then</code> çš„åŸå§‹è°ƒç”¨çš„é¡ºåºæ‰§è¡Œã€‚</li><li>å¦‚æœ/å½“ <code>promise</code> æ‰§è¡Œè¢«æ‹’ç»åï¼Œæ‰€æœ‰ç›¸åº”çš„ <code>onRejected</code> å›è°ƒå‡½æ•°ï¼Œå¿…é¡»æŒ‰ç…§å¯¹ <code>then</code> çš„åŸå§‹è°ƒç”¨çš„é¡ºåºæ‰§è¡Œã€‚</li></ol></li><li><p><code>then</code> å¿…é¡»è¿”å›ä¸€ä¸ª promise å¯¹è±¡ <sup><a id="ref-3-3" href="#3-3" rel="footnote">[3.3]</a></sup></p><pre class="line-numbers language-js"><code class="language-js">promise2 <span class="token operator">=</span> promise1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>onFulfilled<span class="token punctuation">,</span> onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol><li>å¦‚æœ <code>onFulfilled</code> æˆ–è€… <code>onRejected</code> ä¸­ä»»ä½•ä¸€ä¸ªè¿”å›ä¸€ä¸ªå€¼ <code>x</code> ï¼Œè¿è¡Œ Promise Resolution Procedure <code>[[Resolve]](promise2, x)</code>ã€‚</li><li>å¦‚æœ <code>onFulfilled</code> æˆ–è€… <code>onRejected</code> æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ <code>e</code>ï¼Œ<code>promise2</code> å¿…é¡»ä»¥ <code>e</code> ä½œä¸ºè¢«æ‹’ç»æ‰§è¡Œçš„åŸå› ã€‚</li><li>å¦‚æœ <code>onFulfilled</code> ä¸æ˜¯å‡½æ•°ï¼Œå¹¶ä¸” <code>promise1</code> æ‰§è¡Œå®Œæˆï¼Œ<code>promise2</code> å¿…é¡»ç”¨å’Œ <code>promise1</code> ç›¸åŒçš„ value è¾¾åˆ°å®Œæˆæ€ã€‚</li><li>å¦‚æœ <code>onRejected</code> ä¸æ˜¯å‡½æ•°ï¼Œå¹¶ä¸” <code>promise1</code> æ‰§è¡Œè¢«æ‹’ç»ï¼Œ<code>promise2</code> å¿…é¡»ç”¨å’Œ <code>promise1</code> ç›¸åŒçš„ reason è¾¾åˆ°æ‹’ç»æ€ã€‚</li></ol></li></ol><h3 id="Promise-Resolution-Procedureï¼ˆPRPï¼‰"><a href="#Promise-Resolution-Procedureï¼ˆPRPï¼‰" class="headerlink" title="Promise Resolution Procedureï¼ˆPRPï¼‰"></a>Promise Resolution Procedureï¼ˆPRPï¼‰</h3><p><strong>Promise Resolution Procedureï¼ˆpromise è§£å†³è¿‡ç¨‹ï¼‰</strong> æ˜¯ä¸€ä¸ªä»¥ promise å’Œä¸€ä¸ªå€¼ä½œä¸ºè¾“å…¥å‚æ•°çš„æŠ½è±¡æ“ä½œï¼Œ<br>æˆ‘ä»¬å°†å…¶è¡¨ç¤ºä¸º <code>[[Resolve]](promise, x)</code>ã€‚å¦‚æœ <code>x</code> æ˜¯ä¸€ä¸ª thenable çš„å¯¹è±¡ï¼ˆå³ä¸€ä¸ªæ‹¥æœ‰ then æ–¹æ³•çš„å‡½æ•°æˆ–å¯¹è±¡ï¼‰ï¼Œå‡è®¾ <code>x</code> çš„è¡Œä¸ºè‡³å°‘æœ‰ç‚¹åƒ <code>promise</code>ï¼Œé‚£ä¹ˆ PRP è¯•å›¾ä½¿ <code>promise</code> é‡‡ç”¨ <code>x</code> çš„çŠ¶æ€ï¼›å¦åˆ™ç”¨ <code>x</code> çš„å€¼æ¥å®Œæˆ <code>promise</code>ã€‚</p><p>è¿™ç§å¯¹ thenable çš„å¤„ç†å…è®¸ promise å®ç°ç›¸äº’æ“ä½œï¼Œåªè¦ä»–ä»¬å…¬å¼€ä¸€ä¸ª Promises/A+ å…¼å®¹çš„ <code>then</code> æ–¹æ³•å³å¯ã€‚å®ƒä¹Ÿå…è®¸å¯¹é‚£äº›ä¸ç¬¦åˆ Promises/A+ çš„ <code>then</code> æ–¹æ³•è¿›è¡Œâ€å¸æ”¶â€ã€‚</p><p>è¦è¿è¡Œ <code>[[Resolve]](promise, x)</code>ï¼Œéœ€é€šè¿‡ä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li>å¦‚æœ <code>promise</code> å’Œ <code>x</code> å¼•ç”¨åŒä¸€å¯¹è±¡<sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="å³å¾ªç¯å¼•ç”¨ã€‚">[1]</span></a></sup>ï¼Œä»¥ <code>TypeError</code> ä¸ºåŸå› æ‹’ç» promiseã€‚</li><li>å¦‚æœ <code>x</code> æ˜¯ä¸€ä¸ª promise å¯¹è±¡ï¼Œåˆ™ é‡‡ç”¨ <code>x</code> çš„çŠ¶æ€ <sup><a id="ref-3-4" href="#3-4" rel="footnote">[3.4]</a></sup>ã€‚<ol><li>å¦‚æœ <code>x</code> å¤„äº pendingï¼Œ<code>promise</code> å¿…é¡»ä¿æŒ pending ç›´åˆ° <code>x</code> å˜æˆ fulfilled æˆ– rejectedã€‚</li><li>å¦‚æœ/å½“ <code>x</code> å¤„äº fulfilledï¼Œä½¿ç”¨ç›¸åŒçš„ value å®Œæˆ <code>promise</code>ã€‚</li><li>å¦‚æœ/å½“ <code>x</code> å¤„äº rejectedï¼Œä½¿ç”¨ç›¸åŒçš„ reason æ‹’ç» <code>promise</code>ã€‚</li></ol></li><li>æ­¤å¤–ï¼Œå¦‚æœ <code>x</code> æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–å‡½æ•°ï¼š<ol><li>æŠŠ <code>x.then</code> èµ‹å€¼ç»™ <code>then</code>ã€‚<sup><a id="ref-3-5" href="#3-5" rel="footnote">[3.5]</a></sup></li><li>å¦‚æœå–å±æ€§ <code>x.then</code> çš„å€¼æ—¶æ„å¤–æŠ›å‡ºé”™è¯¯ <code>e</code>ï¼Œåˆ™ä½¿ç”¨ <code>e</code> ä½œä¸ºåŸå› æ‹’ç» <code>promise</code>ã€‚</li><li>å¦‚æœ <code>then</code> æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåˆ™ä»¥ <code>x</code> ä½œä¸º <code>this</code> å¯¹å…¶è°ƒç”¨ï¼Œä»¥ <code>resolvePromise</code> ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ<code>rejectPromise</code> ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼Œå…¶ä¸­:<ol><li>å¦‚æœ/å½“ä»¥å€¼ <code>y</code> ä¸ºå‚æ•°è°ƒç”¨ <code>resolvePromise</code> æ—¶ï¼Œåˆ™è¿è¡Œ <code>[[Resolve]](promise, y)</code>ã€‚</li><li>å¦‚æœ/å½“ä»¥åŸå›  <code>r</code> ä¸ºå‚æ•°è°ƒç”¨ <code>rejectPromise</code> æ—¶ï¼Œåˆ™ä½¿ç”¨ <code>r</code> æ‹’ç» <code>promise</code>ã€‚</li><li>å¦‚æœ <code>resolvePromise</code> å’Œ <code>rejectPromise</code> éƒ½è¢«è°ƒç”¨ï¼Œæˆ–è€…è¢«ä½¿ç”¨ç›¸åŒçš„å‚æ•°è°ƒç”¨äº†å¤šæ¬¡ï¼Œåˆ™é¦–æ¬¡è°ƒç”¨å°†è¢«ä¼˜å…ˆé‡‡ç”¨ï¼Œä»»ä½•å…¶å®ƒè°ƒç”¨å°†è¢«å¿½ç•¥ã€‚</li><li>å¦‚æœè°ƒç”¨ <code>then</code> æŠ›å‡ºå¼‚å¸¸ <code>e</code>ï¼š<ol><li>å¦‚æœ <code>resolvePromise</code> æˆ– <code>rejectPromise</code> å·²ç»è¢«è°ƒç”¨ï¼Œåˆ™å¿½ç•¥è¯¥å¼‚å¸¸ã€‚</li><li>å¦åˆ™ï¼Œä½¿ç”¨ <code>e</code> ä¸ºåŸå› æ‹’ç» <code>promise</code>ã€‚</li></ol></li></ol></li><li>å¦‚æœ <code>then</code> ä¸æ˜¯å‡½æ•°ï¼Œä»¥ <code>x</code> ä¸ºå€¼å®Œæˆ <code>promise</code>ã€‚</li></ol></li><li>å¦‚æœ <code>x</code> ä¸æ˜¯å¯¹è±¡æˆ–è€…å‡½æ•°ï¼Œä»¥ <code>x</code> ä¸ºå€¼å®Œæˆ <code>promise</code>ã€‚</li></ol><p>å¦‚æœä½¿ç”¨å‚ä¸å¾ªç¯ thenable é“¾çš„ thenable æ¥ resolve promise<sup id="fnref:2"><a href="#fn:2" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="å³è°ƒç”¨æ—¶ç±»ä¼¼[[Resolve]](promise, promise)ï¼Œè¿™æ ·çš„è¯è¿™ä¸¤ä¸ªå®å‚æ˜¯åŒä¸€ä¸ª promise å¯¹è±¡ï¼Œåˆ™ä¼šå¯¼è‡´æ— é™é€’å½’ã€‚">[2]</span></a></sup>ï¼Œç”±äº <code>[[Resolve]](promise, thenable)</code> çš„é€’å½’æ€§è´¨æœ€ç»ˆå¯¼è‡´å†æ¬¡è°ƒç”¨ <code>[[Resolve]](promise, thenable)</code>ï¼ŒæŒ‰ç…§ä¸Šé¢çš„ç®—æ³•å°†ä¼šå¯¼è‡´æ— é™é€’å½’ã€‚æœ¬è§„èŒƒé¼“åŠ±ä½†ä¸è¦æ±‚å®ç°æ£€æµ‹è¿™ç§é€’å½’ï¼Œå¹¶ä»¥ <code>TypeError</code> ä½œä¸ºåŸå› æ‹’ç» <code>promise</code><sup><a id="ref-3-6" href="#3-6" rel="footnote">[3.6]</a></sup>ã€‚</p><h2 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h2><p id="3-1">    <span style="float: left;">3.1. </span>    </p><p style="margin-left: 32px;">        è¿™é‡Œâ€œå¹³å°ä»£ç â€æ˜¯æŒ‡å¼•æ“ã€ç¯å¢ƒä»¥åŠ promise çš„å®ç°ä»£ç ã€‚        å®é™…ä¸Šï¼Œè¿™ä¸ªè¦æ±‚ç¡®ä¿äº† <code>onFulfilled</code> å’Œ <code>onRejected</code> å¼‚æ­¥æ‰§è¡Œï¼Œ        å³åœ¨è°ƒç”¨ <code>then</code> æ–¹æ³•çš„é‚£ä¸ªäº‹ä»¶å¾ªç¯ä¹‹åçš„æ–°æ‰§è¡Œæ ˆä¸­æ‰§è¡Œã€‚        è¿™ä¸ªå¯ä»¥é€šè¿‡"å®ä»»åŠ¡ï¼ˆmacro-taskï¼‰"æœºåˆ¶å¦‚ <code><a href="https://html.spec.whatwg.org/multipage/webappapis.html#timers" target="_blank" rel="noopener">setTimeout</a></code> æˆ–è€… <code><a href="https://dvcs.w3.org/hg/webperf/raw-file/tip/specs/setImmediate/Overview.html#processingmodel" target="_blank" rel="noopener">setImmediate</a></code>        æˆ–è€…"å¾®ä»»åŠ¡ï¼ˆmicro-taskï¼‰"æœºåˆ¶å¦‚ <code><a href="https://dom.spec.whatwg.org/#interface-mutationobserver" target="_blank" rel="noopener">MutationObserver</a></code> æˆ–è€… <code><a href="https://nodejs.org/api/process.html#process_process_nexttick_callback" target="_blank" rel="noopener">process.nextTick</a></code> æ¥å®ç°ã€‚        å› ä¸º promise çš„å®ç°è¢«å½“ä½œæ˜¯å¹³å°ä»£ç ï¼Œ        æ‰€ä»¥å®ƒæœ¬èº«å¯èƒ½ä¼šåŒ…å«ä¸€ä¸ªä»»åŠ¡è°ƒåº¦é˜Ÿåˆ—æˆ–è€… "trampoline" æ¥è°ƒç”¨å¤„ç†ç¨‹åºã€‚        <a href="#ref-3-1" rev="footnote"> â†©</a>    </p><p></p><p id="3-2">    <span style="float: left;">3.2. </span>    </p><p style="margin-left: 32px;">        ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>this</code> çš„å€¼ï¼Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ä¸º <code>undefined</code>ï¼›        åœ¨å®½æ¾æ¨¡å¼ä¸‹ä¸º global å¯¹è±¡ã€‚        <a href="#ref-3-2" rev="footnote"> â†©</a>    </p><p></p><p id="3-3">    <span style="float: left;">3.3. </span>    </p><p style="margin-left: 32px;">        å®ç°å¯èƒ½å…è®¸ <code>promise2 === promise1</code>ï¼Œå‰ææ˜¯å®ç°æ»¡è¶³æ‰€æœ‰éœ€æ±‚ã€‚æ¯ä¸ªå®ç°éƒ½åº”è¯¥è®°å½•å®ƒæ˜¯å¦èƒ½å¤Ÿç”Ÿæˆ <code>promise2 === promise1</code>ï¼Œä»¥åŠåœ¨ä»€ä¹ˆæ¡ä»¶ä¸‹ç”Ÿæˆã€‚        <a href="#ref-3-3" rev="footnote"> â†©</a>    </p><p></p><p id="3-4">    <span style="float: left;">3.4. </span>    </p><p style="margin-left: 32px;">        é€šå¸¸ï¼Œåªæœ‰å½“ <code>x</code> æ¥è‡ªå½“å‰å®ç°ï¼Œæˆ‘ä»¬æ‰çŸ¥é“å®ƒæ˜¯ä¸€ä¸ªçœŸæ­£çš„ promise å¯¹è±¡ã€‚        æ­¤æ¡æ¬¾å…è®¸ä½¿ç”¨ç‰¹å®šå®ç°ä¸­çš„æ–¹æ³•æ¥é‡‡ç”¨ç¬¦åˆè§„èŒƒçš„ promise å¯¹è±¡çš„çŠ¶æ€ã€‚        <a href="#ref-3-4" rev="footnote"> â†©</a>    </p><p></p><p id="3-5">    <span style="float: left;">3.5. </span>    </p><p style="margin-left: 32px;">        è¿™ä¸ªè¿‡ç¨‹é¦–å…ˆå­˜å‚¨å¯¹ <code>x.then</code> çš„å¼•ç”¨ï¼Œç„¶åæµ‹è¯•è¯¥å¼•ç”¨ï¼Œç„¶åè°ƒç”¨è¯¥å¼•ç”¨ï¼Œ        é¿å…äº†å¯¹ <code>x.then</code> çš„å¤šæ¬¡è®¿é—®ã€‚        è¿™ä¸€æ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆä¼šå­˜å‚¨ä¸€ä¸ªæŒ‡å‘ x.then çš„å¼•ç”¨ï¼Œç„¶åæµ‹è¯•è¯¥è°ƒç”¨ï¼Œä¹‹åè°ƒç”¨è¯¥å¼•ç”¨ï¼Œ        è¿™ä¸€ç³»åˆ—è¿‡ç¨‹ä¸ºäº†é˜²æ­¢å¯¹ <code>x.then</code> å±æ€§çš„å¤šå¤„è®¿é—®ã€‚        è¿™äº›é¢„é˜²æªæ–½å¯¹äºç¡®ä¿è®¿é—®å™¨å±æ€§çš„ä¸€è‡´æ€§éå¸¸é‡è¦ï¼Œå› ä¸ºè®¿é—®å™¨å±æ€§çš„å€¼å¯èƒ½åœ¨æ£€ç´¢ä¹‹é—´å‘ç”Ÿå˜åŒ–        <sup id="fnref:3">            <a href="#fn:3" rel="footnote">            <span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="ES5 çš„ getter ç‰¹æ€§å¯èƒ½ä¼šäº§ç”Ÿå‰¯ä½œç”¨ã€‚">                [3]            </span>            </a>        </sup>ã€‚        <a href="#ref-3-5" rev="footnote"> â†©</a>    </p><p></p><p id="3-6">    <span style="float: left;">3.6. </span>    </p><p style="margin-left: 32px;">        æœ¬è§„èŒƒçš„å®ç° <em>ä¸åº”è¯¥</em> éšæ„é™åˆ¶ thenable é“¾çš„æ·±åº¦ï¼Œå¹¶å‡è®¾åœ¨è¿™ä¸ªé™åˆ¶ä¹‹å¤–é€’å½’æ˜¯æ— é™çš„ã€‚        åªæœ‰çœŸæ­£çš„å¾ªç¯é€’å½’æ‰åº”å¯¼è‡´ä¸€ä¸ª <code>TypeError</code>ï¼›å¦‚æœä¸€æ¡æ— é™é•¿é“¾ä¸Šçš„ thenable å¯¹è±¡å„ä¸ç›¸åŒï¼Œ        é‚£ä¹ˆæ— é™é€’å½’æ˜¯æ­£ç¡®çš„è¡Œä¸ºã€‚        <a href="#ref-3-6" rev="footnote"> â†©</a>    </p><p></p><h2 id="è¯‘è€…æ³¨"><a href="#è¯‘è€…æ³¨" class="headerlink" title="è¯‘è€…æ³¨"></a>è¯‘è€…æ³¨</h2><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">å³å¾ªç¯å¼•ç”¨ã€‚<a href="#fnref:1" rev="footnote"> â†©</a></span></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">2.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">å³è°ƒç”¨æ—¶ç±»ä¼¼[[Resolve]](promise, promise)ï¼Œè¿™æ ·çš„è¯è¿™ä¸¤ä¸ªå®å‚æ˜¯åŒä¸€ä¸ª promise å¯¹è±¡ï¼Œåˆ™ä¼šå¯¼è‡´æ— é™é€’å½’ã€‚<a href="#fnref:2" rev="footnote"> â†©</a></span></li><li id="fn:3"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">3.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">ES5 çš„ getter ç‰¹æ€§å¯èƒ½ä¼šäº§ç”Ÿå‰¯ä½œç”¨ã€‚<a href="#fnref:3" rev="footnote"> â†©</a></span></li></ol></div></div>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> promise </tag>
            
            <tag> è§„èŒƒ </tag>
            
            <tag> è¯‘æ–‡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ‰‹å†™ Promise</title>
      <link href="/2019/11/28/handwritten-promise/"/>
      <url>/2019/11/28/handwritten-promise/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>å¦‚æœä½ è¿˜æ²¡ç”¨è¿‡ promiseï¼Œçœ‹ä¸€çœ‹ç”¨ä¸€ç”¨<a href="http://es6.ruanyifeng.com/#docs/promise" target="_blank" rel="noopener">é˜®ä¸€å³°è€å¸ˆçš„es6</a>ã€‚<br>æœ¬ Promise åŸºäº <a href="https://promisesaplus.com/" target="_blank" rel="noopener">Promise/A+è§„èŒƒ</a> å®ç°ï¼Œè¿™é‡Œæ˜¯å°å¼Ÿè¯‘çš„ <a href="http://sunxuedong.com/2019/12/03/translate-promise-a-plus-specifications">ã€è¯‘ã€‘Promise/A+è§„èŒƒ</a>ã€‚</p><h2 id="promise-ç®€ä»‹"><a href="#promise-ç®€ä»‹" class="headerlink" title="promise ç®€ä»‹"></a>promise ç®€ä»‹</h2><blockquote><p>1.promise æ˜¯æœ‰çŠ¶æ€çš„ã€‚åˆ†åˆ«ä¸ºï¼špendingï¼ˆç­‰å¾…æ€ï¼‰ã€fulfilledï¼ˆå®Œæˆæ€ï¼‰å’Œrejectedï¼ˆå¤±è´¥æ€ï¼‰ã€‚<br>2.promise æœ‰ <code>then</code> æ–¹æ³•ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ® promise çš„çŠ¶æ€ç›¸åº”çš„è°ƒç”¨å›è°ƒå‡½æ•°ã€‚<br>3.<code>then</code> æ–¹æ³•æ”¯æŒé“¾å¼è°ƒç”¨ã€‚</p></blockquote><h2 id="promise-çš„çŠ¶æ€"><a href="#promise-çš„çŠ¶æ€" class="headerlink" title="promise çš„çŠ¶æ€"></a>promise çš„çŠ¶æ€</h2><p>1.æè¿°ï¼š<br>    promise å¿…é¡»æ˜¯ä¸‰ç§çŠ¶æ€ä¹‹ä¸€ï¼špendingï¼ˆç­‰å¾…æ€ï¼‰ã€fulfilledï¼ˆå®Œæˆæ€ï¼‰æˆ– rejectedï¼ˆæ‹’ç»æ€ï¼‰ã€‚é€šè¿‡è°ƒç”¨ resolve å‡½æ•°æˆ– reject å‡½æ•°æ¥æ”¹å˜ promise çš„çŠ¶æ€ã€‚</p><pre class="line-numbers language-js"><code class="language-js"><span class="token comment" spellcheck="true">// æœ€ç»ˆæˆ‘ä»¬å¯ä»¥è¿™æ ·è°ƒç”¨</span><span class="token keyword">new</span> <span class="token class-name">Promise2</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// do something...</span>    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'xxx'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2.å®ç°ï¼š</p><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Promise2</span> <span class="token punctuation">{</span>    constructor <span class="token punctuation">(</span>executor<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">'pending'</span>        <span class="token keyword">const</span> resolve <span class="token operator">=</span> value <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token boolean">false</span>            <span class="token punctuation">}</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value            <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">'fulfilled'</span>        <span class="token punctuation">}</span>        <span class="token keyword">const</span> reject <span class="token operator">=</span> reason <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token boolean">false</span>            <span class="token punctuation">}</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> reason            <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">'rejected'</span>        <span class="token punctuation">}</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token function">executor</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ·»åŠ -then-æ–¹æ³•"><a href="#æ·»åŠ -then-æ–¹æ³•" class="headerlink" title="æ·»åŠ  then æ–¹æ³•"></a>æ·»åŠ  <code>then</code> æ–¹æ³•</h2><p>1.æè¿°ï¼šä¸»è¦æ€æƒ³å°±æ˜¯å‘å¸ƒä¸è®¢é˜…ã€‚è¯´ç™½äº†å°±æ˜¯æŠŠå›è°ƒå‡½æ•°å­˜åˆ°æ•°ç»„é‡Œï¼Œç­‰æ»¡è¶³ä¸€å®šæ¡ä»¶å†éå†æ‰§è¡Œä¸€éï¼Œä¸‹é¢æ¥ç€ä¸Šä¸€æ­¥ğŸ‘†çš„ä»£ç å†™ã€‚</p><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">Promise2</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'xxx'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>val <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>2.å®ç°ï¼š</p><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Promise2</span> <span class="token punctuation">{</span>    constructor <span class="token punctuation">(</span>executor<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">'pending'</span>        <span class="token comment" spellcheck="true">// å­˜æ”¾ onResolved å›è°ƒå‡½æ•°çš„æ•°ç»„</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token comment" spellcheck="true">// å­˜æ”¾ onRejected å›è°ƒå‡½æ•°çš„æ•°ç»„</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">const</span> resolve <span class="token operator">=</span> value <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token boolean">false</span>            <span class="token punctuation">}</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value            <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">'fulfilled'</span>            <span class="token comment" spellcheck="true">// ç­‰çŠ¶æ€å˜æˆ fulfilled åï¼Œéå†æ‰§è¡Œå›è°ƒå‡½æ•°</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>fn <span class="token operator">=</span><span class="token operator">></span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>        <span class="token keyword">const</span> reject <span class="token operator">=</span> reason <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token boolean">false</span>            <span class="token punctuation">}</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> reason            <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">'rejected'</span>            <span class="token comment" spellcheck="true">// ç­‰çŠ¶æ€å˜æˆ rejected åï¼Œéå†æ‰§è¡Œå›è°ƒå‡½æ•°</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>fn <span class="token operator">=</span><span class="token operator">></span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token function">executor</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    then <span class="token punctuation">(</span>onFulfilled<span class="token punctuation">,</span> onRejected<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state        <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">case</span> <span class="token string">'pending'</span><span class="token punctuation">:</span>                <span class="token comment" spellcheck="true">// å¦‚æœå½“å‰ promise çŠ¶æ€è¿˜æ˜¯ pendingï¼Œåˆ™å°†å›è°ƒå‡½æ•°æ”¾åœ¨å¯¹åº”çš„æ•°ç»„é‡Œ</span>                <span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>onFulfilled<span class="token punctuation">)</span>                <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span>                <span class="token keyword">break</span>            <span class="token keyword">case</span> <span class="token string">'fulfilled'</span><span class="token punctuation">:</span>                <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>                <span class="token keyword">break</span>            <span class="token keyword">case</span> <span class="token string">'rejected'</span><span class="token punctuation">:</span>                <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span>                <span class="token keyword">break</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="then-æ–¹æ³•çš„é“¾å¼è°ƒç”¨"><a href="#then-æ–¹æ³•çš„é“¾å¼è°ƒç”¨" class="headerlink" title="then æ–¹æ³•çš„é“¾å¼è°ƒç”¨"></a><code>then</code> æ–¹æ³•çš„é“¾å¼è°ƒç”¨</h2><p>1.æè¿°ï¼šä½¿ <code>then</code> æ–¹æ³•èƒ½å¤Ÿé“¾å¼è°ƒç”¨ï¼Œé¦–å…ˆthenæ–¹æ³•è¿”å›çš„è‚¯å®šæ˜¯ä¸€ä¸ª promise å¯¹è±¡ï¼Œå¦‚æœ <code>then</code> æ–¹æ³•çš„å›è°ƒå‡½æ•°é‡Œè¿”å›çš„ä¹Ÿæ˜¯ä¸ª promise å¯¹è±¡ï¼Œé‚£ä¹ˆæœ€ç»ˆè¿”å›è¿™ä¸ª promise å¯¹è±¡ resolve ä¼ å…¥çš„å€¼æˆ– <code>then</code> æ–¹æ³•é‡Œ return çš„å€¼ï¼Œä¸¾å‡ ä¸ªä¾‹å­å¦‚ï¼š</p><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>resolve <span class="token operator">=</span><span class="token operator">></span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>resolve <span class="token operator">=</span><span class="token operator">></span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'xxx'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">// xxx</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚ï¼š</p><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>resolve <span class="token operator">=</span><span class="token operator">></span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>      <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>resolve <span class="token operator">=</span><span class="token operator">></span>         <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'yyy'</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">)</span>  <span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">// yyy</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>æ€»ä¹‹ï¼Œåœ¨ä¸€é¡¿ promise çä¹±åµŒå¥—æ—¶ï¼Œè‚¯å®šå¾—è¿”å›æœ€åä¸€ä¸ª promise resolve æˆ– reject çš„å€¼ã€‚</p></blockquote><p>2.å®ç°ï¼š</p><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Promise2</span> <span class="token punctuation">{</span>    constructor <span class="token punctuation">(</span>executor<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">'pending'</span>        <span class="token comment" spellcheck="true">// å­˜æ”¾ onResolved å›è°ƒå‡½æ•°çš„æ•°ç»„</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token comment" spellcheck="true">// å­˜æ”¾ onRejected å›è°ƒå‡½æ•°çš„æ•°ç»„</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">const</span> resolve <span class="token operator">=</span> value <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token boolean">false</span>            <span class="token punctuation">}</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value            <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">'fulfilled'</span>            <span class="token comment" spellcheck="true">// ç­‰çŠ¶æ€å˜æˆ fulfilled åï¼Œéå†æ‰§è¡Œå›è°ƒå‡½æ•°</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>fn <span class="token operator">=</span><span class="token operator">></span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>        <span class="token keyword">const</span> reject <span class="token operator">=</span> reason <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token boolean">false</span>            <span class="token punctuation">}</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> reason            <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">'rejected'</span>            <span class="token comment" spellcheck="true">// ç­‰çŠ¶æ€å˜æˆ rejected åï¼Œéå†æ‰§è¡Œå›è°ƒå‡½æ•°</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>fn <span class="token operator">=</span><span class="token operator">></span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token function">executor</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    then <span class="token punctuation">(</span>onFulfilled<span class="token punctuation">,</span> onRejected<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">const</span> promise2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise2</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state            <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">case</span> <span class="token string">'pending'</span><span class="token punctuation">:</span>                    <span class="token comment" spellcheck="true">// å¦‚æœå½“å‰ promise çŠ¶æ€è¿˜æ˜¯ pendingï¼Œåˆ™å°†å›è°ƒå‡½æ•°æ”¾åœ¨å¯¹åº”çš„æ•°ç»„é‡Œ</span>                    <span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>                      x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>                      <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>                    <span class="token punctuation">}</span><span class="token punctuation">)</span>                    <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>                      x <span class="token operator">=</span> <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span>                      <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>                    <span class="token punctuation">}</span><span class="token punctuation">)</span>                    <span class="token keyword">break</span>                <span class="token keyword">case</span> <span class="token string">'fulfilled'</span><span class="token punctuation">:</span>                    x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>                    <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>                    <span class="token keyword">break</span>                <span class="token keyword">case</span> <span class="token string">'rejected'</span><span class="token punctuation">:</span>                    x <span class="token operator">=</span> <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span>                    <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>                    <span class="token keyword">break</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> promise2    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/** * @func resolvePromise * @desc resolvePromiseåŸºäºPromise/A+é€’å½’å¤„ç†promiseåµŒå¥—çš„å‡½æ•°ã€‚ * @desc resolvePromiseæ–¹æ³•è¿›è¡Œé€’å½’ï¼Œå¦‚æœresolveçš„å€¼æ˜¯ä»æ˜¯ä¸ªpromiseå¯¹è±¡ï¼Œåˆ™é€’å½’ã€‚ * @desc ç›´åˆ°resolveæ˜¯ä¸ªépromiseçš„å€¼æ‰ä¼šåœæ­¢é€’å½’ã€‚ * @param {object} promise2 - thenæ–¹æ³•è¿”å›çš„æ ¹promiseå¯¹è±¡ * @param {any} x - thenæ–¹æ³•å›è°ƒå‡½æ•°è¿”å›çš„å€¼ï¼Œåˆ†ä¸ºä¸¤ç±»ï¼š1.promiseå¯¹è±¡ï¼›2.épromiseå¯¹è±¡ï¼ˆåŒ…æ‹¬åŸºæœ¬æ•°æ®ç±»å‹ï¼‰ * @param {function} resolve - é—­åŒ…å¼•ç”¨ï¼Œthenæ–¹æ³•ä¸­å£°æ˜promise2æ—¶ä¼ å…¥çš„resolve * @param {function} reject - é—­åŒ…å¼•ç”¨ï¼Œthenæ–¹æ³•ä¸­å£°æ˜promise2æ—¶ä¼ å…¥çš„reject */</span><span class="token keyword">function</span> resolvePromise <span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">===</span> promise2<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'Chaining cycle detected for promise'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">let</span> called  <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> x <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> x <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>      <span class="token keyword">let</span> then <span class="token operator">=</span> x<span class="token punctuation">.</span>then      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> then <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>         then<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span>          called <span class="token operator">=</span> <span class="token boolean">true</span>          <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> y<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span> r <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span>          called <span class="token operator">=</span> <span class="token boolean">true</span>          <span class="token function">reject</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span>      called <span class="token operator">=</span> <span class="token boolean">true</span>      <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> promise </tag>
            
            <tag> æ‰‹å†™ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
